---
import BaseLayout from '../layouts/BaseLayout.astro';
import PageHero from '../components/PageHero.astro';
import SplitSection from '../components/SplitSection.astro';
import TestimonialCard from '../components/TestimonialCard.astro';
import CallToAction from '../components/CallToAction.astro';
import { stripeLinks, checkoutUrl, isStripeConfigured } from '../data/stripe';

const selfGuidedUrl = checkoutUrl(stripeLinks.missionPortrait.selfGuided, 'mission-portrait', 'self-guided');
const facilitatedUrl = checkoutUrl(stripeLinks.missionPortrait.facilitated, 'mission-portrait', 'facilitated');
const selfGuidedIsStripe = isStripeConfigured(stripeLinks.missionPortrait.selfGuided);
const facilitatedIsStripe = isStripeConfigured(stripeLinks.missionPortrait.facilitated);
---

<BaseLayout title="Mission Portrait" description="A customized visual daily reminder of who you are and your mission. Discover your purpose with Wildfire Leadership's Mission Portrait.">

  <!-- ===== HERO — Dark cinematic ===== -->
  <PageHero
    variant="dark"
    image="/images/hero-main.jpg"
    title='Mission<br/><em>Portrait</em>'
    subtitle="A customized visual daily reminder of who you are and your mission."
  />

  <!-- ===== WHAT IS A MISSION PORTRAIT — White bg, split layout ===== -->
  <SplitSection
    label="The Tool"
    title='What is a<br/><em>Mission Portrait?</em>'
    description="A Wildfire innovative tool, the custom-tailored Mission Portrait is a daily visual reminder of who you are and your mission. This compass points you toward your purpose of making a difference in other's lives."
    image="/images/mission-portrait-what.png"
    imageAlt="Mission Portrait example graphic"
    imagePosition="right"
    bg="white"
    link={{ text: "See how it works", href: "#pricing" }}
  />

  <!-- ===== PRICING — Warm-white bg ===== -->
  <section id="pricing" class="relative py-24 md:py-32 bg-warm-white">
    <div class="max-w-[1400px] mx-auto px-5 md:px-8">
      <div class="text-center mb-16 md:mb-20">
        <p class="reveal text-xs font-semibold uppercase tracking-[0.3em] text-ember mb-4">Choose Your Path</p>
        <h2 class="reveal reveal-d1 font-display text-3xl md:text-4xl lg:text-5xl text-charcoal leading-[1.1]">
          Two ways to discover<br/><em>your mission.</em>
        </h2>
      </div>

      <div class="grid md:grid-cols-2 gap-6 max-w-4xl mx-auto">
        <!-- Self-Guided -->
        <div class="reveal bg-white rounded-2xl border border-sand/50 p-10 flex flex-col relative overflow-hidden">
          <div class="absolute top-0 right-0 bg-ember text-white text-[11px] uppercase tracking-[0.2em] font-medium px-4 py-1.5 rounded-bl-xl">Most Popular</div>
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-ember mb-4">Self-Guided</p>
          <div class="flex items-baseline gap-3 mb-2">
            <span class="font-display text-5xl text-charcoal">$35</span>
          </div>
          <p class="text-sm text-stone mb-8">One-time purchase</p>

          <ul class="space-y-4 mb-8 flex-1">
            {[
              "Electronic PDF workbook",
              "Step-by-step guidance",
              "Customized digital Mission Portrait",
            ].map((item) => (
              <li class="flex items-start gap-3 text-sm text-charcoal/80 leading-relaxed">
                <svg class="w-5 h-5 text-ember flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                {item}
              </li>
            ))}
          </ul>

          <div class="mb-4" data-pricing-selector>
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-charcoal/50 mb-3">This is for my...</p>
            <div class="flex flex-wrap gap-2">
              {["Student", "Individual", "Marriage/Family", "Organization"].map((option) => (
                <button type="button" class="pricing-pill px-3 py-1.5 rounded-full text-xs font-medium border border-sand/80 text-stone hover:border-ember hover:text-ember transition-all duration-300 cursor-pointer" data-value={option.toLowerCase().replace('/', '-')}>
                  {option}
                </button>
              ))}
            </div>
          </div>

          <div class="mb-6 flex items-center gap-4" data-qty-selector>
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-charcoal/50">Qty</p>
            <div class="inline-flex items-center border border-sand/80 rounded-full">
              <button type="button" data-qty-minus class="w-8 h-8 flex items-center justify-center text-stone hover:text-ember transition-colors duration-300 cursor-pointer">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M5 12h14"/></svg>
              </button>
              <span data-qty-value class="w-8 text-center text-sm font-medium text-charcoal">1</span>
              <button type="button" data-qty-plus class="w-8 h-8 flex items-center justify-center text-stone hover:text-ember transition-colors duration-300 cursor-pointer">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M12 5v14M5 12h14"/></svg>
              </button>
            </div>
          </div>

          <a href={selfGuidedUrl} target={selfGuidedIsStripe ? "_blank" : undefined} rel={selfGuidedIsStripe ? "noopener noreferrer" : undefined} data-cta-link class="group inline-flex items-center justify-center gap-3 w-full px-8 py-4 rounded-full text-sm font-medium tracking-wide text-charcoal border border-charcoal/20 hover:border-ember hover:text-ember transition-all duration-400 hover:shadow-lg hover:shadow-charcoal/5">
            {selfGuidedIsStripe ? "Purchase Now" : "Get Started"}
            <svg class="w-4 h-4 transition-transform duration-400 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
          <a href="/contact" class="text-xs text-stone hover:text-ember text-center mt-3 transition-colors duration-300">Have questions? Contact us</a>
        </div>

        <!-- Facilitated -->
        <div class="reveal reveal-d1 bg-white rounded-2xl border border-sand/50 p-10 flex flex-col">
          <p class="text-xs font-semibold uppercase tracking-[0.3em] text-ember mb-4">Facilitated</p>
          <div class="flex items-baseline gap-3 mb-2">
            <span class="font-display text-5xl text-charcoal">$299</span>
          </div>
          <p class="text-sm text-stone mb-8">Per session</p>

          <ul class="space-y-4 mb-8 flex-1">
            {[
              "60-minute virtual session with Certified Facilitator",
              "All materials included",
              "Electronic PDF workbook",
              "Customized digital Mission Portrait",
            ].map((item) => (
              <li class="flex items-start gap-3 text-sm text-charcoal/80 leading-relaxed">
                <svg class="w-5 h-5 text-ember flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                {item}
              </li>
            ))}
          </ul>

          <div class="mb-4" data-pricing-selector>
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-charcoal/50 mb-3">This is for my...</p>
            <div class="flex flex-wrap gap-2">
              {["Student", "Individual", "Marriage/Family", "Organization"].map((option) => (
                <button type="button" class="pricing-pill px-3 py-1.5 rounded-full text-xs font-medium border border-sand/80 text-stone hover:border-ember hover:text-ember transition-all duration-300 cursor-pointer" data-value={option.toLowerCase().replace('/', '-')}>
                  {option}
                </button>
              ))}
            </div>
          </div>

          <div class="mb-6 flex items-center gap-4" data-qty-selector>
            <p class="text-xs font-semibold uppercase tracking-[0.2em] text-charcoal/50">Qty</p>
            <div class="inline-flex items-center border border-sand/80 rounded-full">
              <button type="button" data-qty-minus class="w-8 h-8 flex items-center justify-center text-stone hover:text-ember transition-colors duration-300 cursor-pointer">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M5 12h14"/></svg>
              </button>
              <span data-qty-value class="w-8 text-center text-sm font-medium text-charcoal">1</span>
              <button type="button" data-qty-plus class="w-8 h-8 flex items-center justify-center text-stone hover:text-ember transition-colors duration-300 cursor-pointer">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-width="2" d="M12 5v14M5 12h14"/></svg>
              </button>
            </div>
          </div>

          <a href={facilitatedUrl} target={facilitatedIsStripe ? "_blank" : undefined} rel={facilitatedIsStripe ? "noopener noreferrer" : undefined} data-cta-link class="group inline-flex items-center justify-center gap-3 w-full px-8 py-4 rounded-full text-sm font-medium tracking-wide text-white bg-charcoal hover:bg-ember transition-all duration-400 hover:shadow-lg hover:shadow-ember/20">
            {facilitatedIsStripe ? "Book & Pay" : "Book Now"}
            <svg class="w-4 h-4 transition-transform duration-400 group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
          <a href="/contact" class="text-xs text-stone hover:text-ember text-center mt-3 transition-colors duration-300">Have questions? Contact us</a>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== PORTRAIT SHOWCASE — White bg ===== -->
  <section class="relative py-24 md:py-32 bg-white">
    <div class="max-w-[1400px] mx-auto px-5 md:px-8">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6 mb-14">
        <div>
          <p class="reveal text-xs font-semibold uppercase tracking-[0.3em] text-ember mb-4">Real Portraits</p>
          <h2 class="reveal reveal-d1 font-display text-3xl md:text-4xl lg:text-5xl text-charcoal leading-[1.05]">
            Every portrait tells<br/>a <em>unique story.</em>
          </h2>
        </div>
      </div>
      <div class="reveal reveal-d2 grid grid-cols-2 lg:grid-cols-4 gap-3 md:gap-4">
        {[
          { src: "/images/portrait-coleen-full.png", name: "Brenda", location: "" },
          { src: "/images/portrait-zeb-full.png", name: "Zeb", location: "Mainstop" },
          { src: "/images/portrait-sarah-full.png", name: "Sarah", location: "Keller" },
          { src: "/images/portrait-ryan-full.png", name: "Ryan", location: "Napoleon" },
        ].map((portrait) => (
          <div class="relative aspect-[3/4] rounded-xl overflow-hidden">
            <img src={portrait.src} alt="Mission Portrait example" class="absolute inset-0 w-full h-full object-cover" />
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- ===== TESTIMONIAL — Cream bg ===== -->
  <section class="relative py-24 md:py-32 bg-cream">
    <div class="max-w-[1400px] mx-auto px-5 md:px-8">
      <TestimonialCard
        variant="large"
        quote="The Mission Portrait I created became a valuable tool in understanding my worth and my purpose."
        name="Lisa Roth"
        title="Whitehouse, OH"
      />
    </div>
  </section>

  <!-- ===== CTA CLOSER ===== -->
  <CallToAction
    title='Your purpose is<br/><em class="ember-gradient">waiting.</em>'
    description="Take the first step toward discovering your mission and creating your personalized Mission Portrait."
  />

</BaseLayout>

<script>
  document.querySelectorAll('[data-pricing-selector]').forEach((selector) => {
    const card = selector.closest('.flex.flex-col');
    const link = card?.querySelector('[data-cta-link]') as HTMLAnchorElement | null;
    const pills = selector.querySelectorAll('.pricing-pill');

    pills.forEach((pill) => {
      pill.addEventListener('click', () => {
        pills.forEach((p) => {
          p.classList.remove('bg-ember', 'text-white', 'border-ember');
          p.classList.add('border-sand/80', 'text-stone');
        });
        pill.classList.add('bg-ember', 'text-white', 'border-ember');
        pill.classList.remove('border-sand/80', 'text-stone');

        if (link) {
          const url = new URL(link.href);
          url.searchParams.set('for', (pill as HTMLElement).dataset.value || '');
          link.href = url.toString();
        }
      });
    });
  });

  document.querySelectorAll('[data-qty-selector]').forEach((selector) => {
    const card = selector.closest('.flex.flex-col');
    const link = card?.querySelector('[data-cta-link]') as HTMLAnchorElement | null;
    const display = selector.querySelector('[data-qty-value]');
    const minus = selector.querySelector('[data-qty-minus]');
    const plus = selector.querySelector('[data-qty-plus]');
    let qty = 1;

    function update() {
      if (display) display.textContent = String(qty);
      if (link) {
        const url = new URL(link.href);
        if (qty > 1) {
          url.searchParams.set('qty', String(qty));
        } else {
          url.searchParams.delete('qty');
        }
        link.href = url.toString();
      }
    }

    minus?.addEventListener('click', () => { if (qty > 1) { qty--; update(); } });
    plus?.addEventListener('click', () => { if (qty < 99) { qty++; update(); } });
  });
</script>
